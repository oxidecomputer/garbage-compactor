From 96a713747b474ff8afd336a6b2763fc9a13d8282 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex@cooperi.net>
Date: Tue, 30 May 2023 13:11:10 +1000
Subject: [PATCH 24/42] 26-sunos-xlocale.patch

diff a/contrib/llvm-project-cmake/CMakeLists.txt.orig b/contrib/llvm-project-cmake/CMakeLists.txt
diff -wpruN --no-dereference '--exclude=*.orig' a~/contrib/llvm-project/libcxx/src/support/solaris/xlocale.cpp a/contrib/llvm-project/libcxx/src/support/solaris/xlocale.cpp
--- a~/contrib/llvm-project/libcxx/src/support/solaris/xlocale.cpp	1970-01-01 00:00:00
+++ a/contrib/llvm-project/libcxx/src/support/solaris/xlocale.cpp	1970-01-01 00:00:00
@@ -11,7 +11,8 @@
 #include "__support/solaris/xlocale.h"
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/localedef.h>
+#include <ctype.h>
+#include <wchar.h>
 
 extern "C" {
 
diff -wpruN --no-dereference '--exclude=*.orig' a~/contrib/llvm-project-cmake/CMakeLists.txt a/contrib/llvm-project-cmake/CMakeLists.txt
--- a~/contrib/llvm-project-cmake/CMakeLists.txt	1970-01-01 00:00:00
+++ a/contrib/llvm-project-cmake/CMakeLists.txt	1970-01-01 00:00:00
@@ -64,6 +64,12 @@ set (REQUIRED_LLVM_LIBRARIES
 #     list(APPEND REQUIRED_LLVM_LIBRARIES LLVMAArch64Info LLVMAArch64Desc LLVMAArch64CodeGen)
 # endif ()
 
+if (OS_SUNOS)
+    set (SRCS ${SRCS}
+        "${LIBCXX_SOURCE_DIR}/src/support/solaris/xlocale.cpp"
+    )
+endif()
+
 set (CMAKE_INSTALL_RPATH "ON") # Do not adjust RPATH in llvm, since then it will not be able to find libcxx/libcxxabi/libunwind
 set (LLVM_COMPILER_CHECKED 1 CACHE INTERNAL "") # Skip internal compiler selection
 set (LLVM_ENABLE_EH 1 CACHE INTERNAL "") # With exception handling
