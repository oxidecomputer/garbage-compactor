From 6cdc53f383b15ae1fbfdf04b9fb8380d1935298d Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex@cooperi.net>
Date: Mon, 29 May 2023 09:58:59 +1000
Subject: [PATCH 13/42] 14-rocksdb.patch

diff -wpruN --no-dereference '--exclude=*.orig' a~/contrib/rocksdb/env/fs_posix.cc a/contrib/rocksdb/env/fs_posix.cc
--- a~/contrib/rocksdb/env/fs_posix.cc	1970-01-01 00:00:00
+++ a/contrib/rocksdb/env/fs_posix.cc	1970-01-01 00:00:00
@@ -635,7 +635,9 @@ class PosixFileSystem : public FileSyste
       // filter out '.' and '..' directory entries
       // which appear only on some platforms
       const bool ignore =
+#ifndef OS_SUNOS
           entry->d_type == DT_DIR &&
+#endif
           (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0);
       if (!ignore) {
         result->push_back(entry->d_name);
diff -wpruN --no-dereference '--exclude=*.orig' a~/contrib/rocksdb/monitoring/perf_context.cc a/contrib/rocksdb/monitoring/perf_context.cc
--- a~/contrib/rocksdb/monitoring/perf_context.cc	1970-01-01 00:00:00
+++ a/contrib/rocksdb/monitoring/perf_context.cc	1970-01-01 00:00:00
@@ -14,11 +14,7 @@ namespace ROCKSDB_NAMESPACE {
 // Put here just to make get_perf_context() simple without ifdef.
 PerfContext perf_context;
 #elif defined(ROCKSDB_SUPPORT_THREAD_LOCAL)
-#if defined(OS_SOLARIS)
-__thread PerfContext perf_context;
-#else   // OS_SOLARIS
 thread_local PerfContext perf_context;
-#endif  // OS_SOLARIS
 #else
 #error "No thread-local support. Disable perf context with -DNPERF_CONTEXT."
 #endif
