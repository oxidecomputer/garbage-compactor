From d00aac20230ba95828578085f686789971f99b14 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex@cooperi.net>
Date: Tue, 6 Jun 2023 13:46:32 +1000
Subject: [PATCH 37/42] 39-sunos-signed-char.patch

diff -wpruN --no-dereference '--exclude=*.orig' a~/base/base/types.h a/base/base/types.h
--- a~/base/base/types.h	1970-01-01 00:00:00
+++ a/base/base/types.h	1970-01-01 00:00:00
@@ -3,7 +3,11 @@
 #include <cstdint>
 #include <string>
 
+#if defined(__sun)
+using Int8 = signed char;
+#else
 using Int8 = int8_t;
+#endif
 using Int16 = int16_t;
 using Int32 = int32_t;
 using Int64 = int64_t;
diff -wpruN --no-dereference '--exclude=*.orig' a~/src/Core/SettingsEnums.h a/src/Core/SettingsEnums.h
--- a~/src/Core/SettingsEnums.h	1970-01-01 00:00:00
+++ a/src/Core/SettingsEnums.h	1970-01-01 00:00:00
@@ -93,7 +93,7 @@ DECLARE_SETTING_ENUM(LogsLevel)
 
 
 // Make it signed for compatibility with DataTypeEnum8
-enum QueryLogElementType : int8_t
+enum QueryLogElementType : Int8
 {
     QUERY_START = 1,
     QUERY_FINISH = 2,
diff -wpruN --no-dereference '--exclude=*.orig' a~/src/DataTypes/DataTypeEnum.cpp a/src/DataTypes/DataTypeEnum.cpp
--- a~/src/DataTypes/DataTypeEnum.cpp	1970-01-01 00:00:00
+++ a/src/DataTypes/DataTypeEnum.cpp	1970-01-01 00:00:00
@@ -78,7 +78,7 @@ std::string DataTypeEnum<Type>::generate
 
         writeQuotedString(name_and_value.first, out);
         writeString(" = ", out);
-        writeText(name_and_value.second, out);
+        writeIntText(name_and_value.second, out);
     }
 
     writeChar(')', out);
diff -wpruN --no-dereference '--exclude=*.orig' a~/src/Functions/divide/divide.cpp a/src/Functions/divide/divide.cpp
--- a~/src/Functions/divide/divide.cpp	1970-01-01 00:00:00
+++ a/src/Functions/divide/divide.cpp	1970-01-01 00:00:00
@@ -50,8 +50,10 @@ template void divideImpl<int64_t, int64_
 template void divideImpl<int64_t, int32_t, int64_t>(const int64_t * __restrict, int32_t, int64_t * __restrict, size_t);
 template void divideImpl<int64_t, int16_t, int64_t>(const int64_t * __restrict, int16_t, int64_t * __restrict, size_t);
 template void divideImpl<int64_t, int8_t, int64_t>(const int64_t * __restrict, int8_t, int64_t * __restrict, size_t);
+template void divideImpl<int64_t, signed char, int64_t>(const int64_t * __restrict, signed char, int64_t * __restrict, size_t);
 
 template void divideImpl<int32_t, int64_t, int32_t>(const int32_t * __restrict, int64_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int32_t, int32_t>(const int32_t * __restrict, int32_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int16_t, int32_t>(const int32_t * __restrict, int16_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int8_t, int32_t>(const int32_t * __restrict, int8_t, int32_t * __restrict, size_t);
+template void divideImpl<int32_t, signed char, int32_t>(const int32_t * __restrict, signed char, int32_t * __restrict, size_t);
diff -wpruN --no-dereference '--exclude=*.orig' a~/src/Functions/divide/divideImpl.cpp a/src/Functions/divide/divideImpl.cpp
--- a~/src/Functions/divide/divideImpl.cpp	1970-01-01 00:00:00
+++ a/src/Functions/divide/divideImpl.cpp	1970-01-01 00:00:00
@@ -63,10 +63,12 @@ template void divideImpl<int64_t, int64_
 template void divideImpl<int64_t, int32_t, int64_t>(const int64_t * __restrict, int32_t, int64_t * __restrict, size_t);
 template void divideImpl<int64_t, int16_t, int64_t>(const int64_t * __restrict, int16_t, int64_t * __restrict, size_t);
 template void divideImpl<int64_t, int8_t, int64_t>(const int64_t * __restrict, int8_t, int64_t * __restrict, size_t);
+template void divideImpl<int64_t, signed char, int64_t>(const int64_t * __restrict, signed char, int64_t * __restrict, size_t);
 
 template void divideImpl<int32_t, int64_t, int32_t>(const int32_t * __restrict, int64_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int32_t, int32_t>(const int32_t * __restrict, int32_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int16_t, int32_t>(const int32_t * __restrict, int16_t, int32_t * __restrict, size_t);
 template void divideImpl<int32_t, int8_t, int32_t>(const int32_t * __restrict, int8_t, int32_t * __restrict, size_t);
+template void divideImpl<int32_t, signed char, int32_t>(const int32_t * __restrict, signed char, int32_t * __restrict, size_t);
 
 }
