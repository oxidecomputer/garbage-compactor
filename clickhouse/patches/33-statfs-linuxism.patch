From eae35f3cff44d2b1c782892f4a4c5a8bf6f4a310 Mon Sep 17 00:00:00 2001
From: Alex Wilson <alex@cooperi.net>
Date: Mon, 5 Jun 2023 13:25:34 +1000
Subject: [PATCH 31/42] 33-statfs-linuxism.patch

diff -wpruN --no-dereference '--exclude=*.orig' a~/utils/self-extracting-executable/decompressor.cpp a/utils/self-extracting-executable/decompressor.cpp
--- a~/utils/self-extracting-executable/decompressor.cpp	1970-01-01 00:00:00
+++ a/utils/self-extracting-executable/decompressor.cpp	1970-01-01 00:00:00
@@ -3,7 +3,7 @@
 #if defined(OS_DARWIN) || defined(OS_FREEBSD)
 #   include <sys/mount.h>
 #else
-#   include <sys/statfs.h>
+#   include <sys/statvfs.h>
 #endif
 #include <fcntl.h>
 #include <sys/wait.h>
@@ -210,10 +210,10 @@ int decompressFiles(int input_fd, char *
     }
 
     /// Check free space
-    struct statfs fs_info;
-    if (0 != fstatfs(input_fd, &fs_info))
+    struct statvfs fs_info;
+    if (0 != fstatvfs(input_fd, &fs_info))
     {
-        perror("fstatfs");
+        perror("fstatvfs");
         if (0 != munmap(input, info_in.st_size))
                 perror("munmap");
         return 1;
