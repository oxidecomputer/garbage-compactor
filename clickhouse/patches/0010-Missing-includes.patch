From 5318985c963424b468c2cbe82696496dfe29499e Mon Sep 17 00:00:00 2001
From: Oxide Computer Company <eng@oxide.computer>
Date: Fri, 24 Oct 2025 15:35:35 -0400
Subject: [PATCH 10/61] Missing includes

---
 base/base/bit_cast.h                                           | 1 +
 base/base/find_symbols.h                                       | 3 +++
 base/poco/Net/include/Poco/Net/HTTPSession.h                   | 1 +
 src/Access/AccessBackup.h                                      | 1 +
 src/Access/DiskAccessStorage.h                                 | 1 +
 src/Access/SettingsConstraints.cpp                             | 1 +
 src/Backups/BackupFileInfo.h                                   | 1 +
 src/Backups/BackupIO.h                                         | 1 +
 src/Backups/BackupStatus.h                                     | 1 +
 src/Backups/BackupsWorker.h                                    | 1 +
 src/Backups/IBackupCoordination.h                              | 2 ++
 src/Backups/IRestoreCoordination.h                             | 2 ++
 src/Backups/RestoreCoordinationLocal.h                         | 1 +
 src/Common/AsyncLoader.h                                       | 1 +
 src/Common/CaresPTRResolver.cpp                                | 1 +
 src/Common/FileChecker.h                                       | 1 +
 src/Common/ProxyConfigurationResolverProvider.h                | 1 +
 src/Common/RemoteHostFilter.h                                  | 1 +
 src/Common/ThreadProfileEvents.h                               | 3 +++
 src/Coordination/RaftServerConfig.h                            | 3 +++
 src/Core/MySQL/MySQLCharset.h                                  | 1 +
 src/Disks/DiskType.cpp                                         | 1 +
 src/Disks/IO/getThreadPoolReader.h                             | 2 ++
 .../DiskObjectStorageRemoteMetadataRestoreHelper.cpp           | 2 ++
 src/Disks/ObjectStorages/DiskObjectStorageTransaction.cpp      | 1 +
 src/Formats/BSONTypes.h                                        | 1 +
 src/Functions/keyvaluepair/impl/KeyValuePairExtractorBuilder.h | 1 +
 src/IO/HTTPHeaderEntries.h                                     | 1 +
 src/Interpreters/InterpreterInsertQuery.h                      | 1 +
 src/Server/waitServersToFinish.h                               | 1 +
 src/Storages/MergeTree/IPartMetadataManager.h                  | 1 +
 src/Storages/NATS/NATSConnection.cpp                           | 2 ++
 src/Storages/NATS/NATSHandler.h                                | 1 +
 src/Storages/StorageLogSettings.h                              | 1 +
 34 files changed, 45 insertions(+)

diff --git a/base/base/bit_cast.h b/base/base/bit_cast.h
index 9a92b766..f2e270b7 100644
--- a/base/base/bit_cast.h
+++ b/base/base/bit_cast.h
@@ -4,6 +4,7 @@
 #include <cstring>
 #include <algorithm>
 #include <type_traits>
+#include <bit>
 
 
 /** Returns value `from` converted to type `To` while retaining bit representation.
diff --git a/base/base/find_symbols.h b/base/base/find_symbols.h
index 30ee759b..f6e36251 100644
--- a/base/base/find_symbols.h
+++ b/base/base/find_symbols.h
@@ -2,7 +2,10 @@
 
 #include <cstdint>
 #include <string>
+#include <cstring>
 #include <array>
+#include <stdexcept>
+#include <memory>
 
 #if defined(__SSE2__)
     #include <emmintrin.h>
diff --git a/base/poco/Net/include/Poco/Net/HTTPSession.h b/base/poco/Net/include/Poco/Net/HTTPSession.h
index cac14f47..234b8fa2 100644
--- a/base/poco/Net/include/Poco/Net/HTTPSession.h
+++ b/base/poco/Net/include/Poco/Net/HTTPSession.h
@@ -19,6 +19,7 @@
 
 
 #include <ios>
+#include <memory>
 #include "Poco/Any.h"
 #include "Poco/Buffer.h"
 #include "Poco/Exception.h"
diff --git a/src/Access/AccessBackup.h b/src/Access/AccessBackup.h
index 51a1112e..b3d8c99e 100644
--- a/src/Access/AccessBackup.h
+++ b/src/Access/AccessBackup.h
@@ -3,6 +3,7 @@
 #include <Core/UUID.h>
 #include <unordered_map>
 #include <unordered_set>
+#include <memory>
 
 
 namespace DB
diff --git a/src/Access/DiskAccessStorage.h b/src/Access/DiskAccessStorage.h
index 40f2017d..ee922354 100644
--- a/src/Access/DiskAccessStorage.h
+++ b/src/Access/DiskAccessStorage.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <condition_variable>
 #include <Access/MemoryAccessStorage.h>
 #include <Common/ThreadPool_fwd.h>
 #include <boost/container/flat_set.hpp>
diff --git a/src/Access/SettingsConstraints.cpp b/src/Access/SettingsConstraints.cpp
index a274f6b5..de9adaf1 100644
--- a/src/Access/SettingsConstraints.cpp
+++ b/src/Access/SettingsConstraints.cpp
@@ -1,3 +1,4 @@
+#include <bitset>
 #include <string_view>
 #include <unordered_map>
 #include <Access/SettingsConstraints.h>
diff --git a/src/Backups/BackupFileInfo.h b/src/Backups/BackupFileInfo.h
index a1405a9c..4550cde4 100644
--- a/src/Backups/BackupFileInfo.h
+++ b/src/Backups/BackupFileInfo.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <memory>
 #include <Core/Types.h>
 #include <Common/ThreadPool_fwd.h>
 #include <Common/Logger.h>
diff --git a/src/Backups/BackupIO.h b/src/Backups/BackupIO.h
index ee2f38c7..c9bcfb8c 100644
--- a/src/Backups/BackupIO.h
+++ b/src/Backups/BackupIO.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <memory>
 #include <Core/Types.h>
 
 
diff --git a/src/Backups/BackupStatus.h b/src/Backups/BackupStatus.h
index 398f2086..ea97927e 100644
--- a/src/Backups/BackupStatus.h
+++ b/src/Backups/BackupStatus.h
@@ -1,6 +1,7 @@
 #pragma once
 
 #include <base/types.h>
+#include <vector>
 
 
 namespace DB
diff --git a/src/Backups/BackupsWorker.h b/src/Backups/BackupsWorker.h
index 946562b5..80e807cc 100644
--- a/src/Backups/BackupsWorker.h
+++ b/src/Backups/BackupsWorker.h
@@ -6,6 +6,7 @@
 #include <Core/UUID.h>
 #include <Parsers/IAST_fwd.h>
 #include <unordered_map>
+#include <condition_variable>
 
 
 namespace Poco::Util { class AbstractConfiguration; }
diff --git a/src/Backups/IBackupCoordination.h b/src/Backups/IBackupCoordination.h
index 166a2c5b..3678987f 100644
--- a/src/Backups/IBackupCoordination.h
+++ b/src/Backups/IBackupCoordination.h
@@ -1,6 +1,8 @@
 #pragma once
 
 #include <Core/Types.h>
+#include <chrono>
+#include <atomic>
 
 
 namespace DB
diff --git a/src/Backups/IRestoreCoordination.h b/src/Backups/IRestoreCoordination.h
index 37229534..6b7d93c1 100644
--- a/src/Backups/IRestoreCoordination.h
+++ b/src/Backups/IRestoreCoordination.h
@@ -1,6 +1,8 @@
 #pragma once
 
 #include <Core/Types.h>
+#include <atomic>
+#include <chrono>
 
 
 namespace DB
diff --git a/src/Backups/RestoreCoordinationLocal.h b/src/Backups/RestoreCoordinationLocal.h
index 35f93574..efd84fa7 100644
--- a/src/Backups/RestoreCoordinationLocal.h
+++ b/src/Backups/RestoreCoordinationLocal.h
@@ -6,6 +6,7 @@
 #include <mutex>
 #include <set>
 #include <unordered_set>
+#include <atomic>
 
 
 namespace DB
diff --git a/src/Common/AsyncLoader.h b/src/Common/AsyncLoader.h
index 05b809ac..48c41808 100644
--- a/src/Common/AsyncLoader.h
+++ b/src/Common/AsyncLoader.h
@@ -7,6 +7,7 @@
 #include <map>
 #include <mutex>
 #include <vector>
+#include <optional>
 #include <unordered_set>
 #include <unordered_map>
 #include <boost/noncopyable.hpp>
diff --git a/src/Common/CaresPTRResolver.cpp b/src/Common/CaresPTRResolver.cpp
index df456c9c..52fe0151 100644
--- a/src/Common/CaresPTRResolver.cpp
+++ b/src/Common/CaresPTRResolver.cpp
@@ -1,6 +1,7 @@
 #include "CaresPTRResolver.h"
 #include <arpa/inet.h>
 #include <sys/select.h>
+#include <sys/poll.h>
 #include <Common/Exception.h>
 #include <Common/logger_useful.h>
 #include "ares.h"
diff --git a/src/Common/FileChecker.h b/src/Common/FileChecker.h
index e2478f79..ea4bc32c 100644
--- a/src/Common/FileChecker.h
+++ b/src/Common/FileChecker.h
@@ -3,6 +3,7 @@
 #include <Storages/CheckResults.h>
 #include <Common/Logger.h>
 #include <map>
+#include <memory>
 #include <base/types.h>
 #include <memory>
 #include <mutex>
diff --git a/src/Common/ProxyConfigurationResolverProvider.h b/src/Common/ProxyConfigurationResolverProvider.h
index ebf22f7e..fbc4facc 100644
--- a/src/Common/ProxyConfigurationResolverProvider.h
+++ b/src/Common/ProxyConfigurationResolverProvider.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <memory>
 #include <base/types.h>
 #include <Poco/Util/AbstractConfiguration.h>
 #include <Common/ProxyConfigurationResolver.h>
diff --git a/src/Common/RemoteHostFilter.h b/src/Common/RemoteHostFilter.h
index 4c898320..3bcc5094 100644
--- a/src/Common/RemoteHostFilter.h
+++ b/src/Common/RemoteHostFilter.h
@@ -4,6 +4,7 @@
 #include <string>
 #include <vector>
 #include <mutex>
+#include <atomic>
 #include <unordered_set>
 #include <base/defines.h>
 
diff --git a/src/Common/ThreadProfileEvents.h b/src/Common/ThreadProfileEvents.h
index 0af3ccb4..6edb7958 100644
--- a/src/Common/ThreadProfileEvents.h
+++ b/src/Common/ThreadProfileEvents.h
@@ -7,6 +7,9 @@
 #include <Common/ProfileEvents.h>
 #include <sys/time.h>
 #include <sys/resource.h>
+#ifdef OS_SUNOS
+#include <iso/limits_iso.h>
+#endif
 #include <pthread.h>
 #include <boost/noncopyable.hpp>
 
diff --git a/src/Coordination/RaftServerConfig.h b/src/Coordination/RaftServerConfig.h
index 37b6a92b..31371b7b 100644
--- a/src/Coordination/RaftServerConfig.h
+++ b/src/Coordination/RaftServerConfig.h
@@ -3,6 +3,9 @@
 #include <base/types.h>
 #include <fmt/core.h>
 #include <libnuraft/srv_config.hxx>
+#include <optional>
+#include <vector>
+#include <variant>
 
 #include <optional>
 
diff --git a/src/Core/MySQL/MySQLCharset.h b/src/Core/MySQL/MySQLCharset.h
index eaec40d5..54df72c3 100644
--- a/src/Core/MySQL/MySQLCharset.h
+++ b/src/Core/MySQL/MySQLCharset.h
@@ -3,6 +3,7 @@
 #include <base/types.h>
 #include <boost/noncopyable.hpp>
 #include <mutex>
+#include <memory>
 
 struct UConverter;
 
diff --git a/src/Disks/DiskType.cpp b/src/Disks/DiskType.cpp
index 07a70994..c226abac 100644
--- a/src/Disks/DiskType.cpp
+++ b/src/Disks/DiskType.cpp
@@ -1,6 +1,7 @@
 #include "DiskType.h"
 #include <Poco/String.h>
 #include <Common/Exception.h>
+#include <tuple>
 
 namespace DB
 {
diff --git a/src/Disks/IO/getThreadPoolReader.h b/src/Disks/IO/getThreadPoolReader.h
index 14de15e3..dcdcbb47 100644
--- a/src/Disks/IO/getThreadPoolReader.h
+++ b/src/Disks/IO/getThreadPoolReader.h
@@ -1,5 +1,7 @@
 #pragma once
 
+#include <memory>
+
 namespace Poco::Util { class AbstractConfiguration; }
 
 namespace DB
diff --git a/src/Disks/ObjectStorages/DiskObjectStorageRemoteMetadataRestoreHelper.cpp b/src/Disks/ObjectStorages/DiskObjectStorageRemoteMetadataRestoreHelper.cpp
index 701c08b9..62f742a5 100644
--- a/src/Disks/ObjectStorages/DiskObjectStorageRemoteMetadataRestoreHelper.cpp
+++ b/src/Disks/ObjectStorages/DiskObjectStorageRemoteMetadataRestoreHelper.cpp
@@ -16,6 +16,8 @@ namespace CurrentMetrics
     extern const Metric LocalThreadScheduled;
 }
 
+#include <bitset>
+
 namespace DB
 {
 
diff --git a/src/Disks/ObjectStorages/DiskObjectStorageTransaction.cpp b/src/Disks/ObjectStorages/DiskObjectStorageTransaction.cpp
index 522761ab..d3e7fdbd 100644
--- a/src/Disks/ObjectStorages/DiskObjectStorageTransaction.cpp
+++ b/src/Disks/ObjectStorages/DiskObjectStorageTransaction.cpp
@@ -4,6 +4,7 @@
 #include <Interpreters/Context.h>
 #include <Common/checkStackSize.h>
 #include <ranges>
+#include <bitset>
 #include <Common/logger_useful.h>
 #include <Common/Exception.h>
 #include <Disks/WriteMode.h>
diff --git a/src/Formats/BSONTypes.h b/src/Formats/BSONTypes.h
index cfef3902..30406eaa 100644
--- a/src/Formats/BSONTypes.h
+++ b/src/Formats/BSONTypes.h
@@ -2,6 +2,7 @@
 
 #include <cstdint>
 #include <string>
+#include <numeric>
 
 namespace DB
 {
diff --git a/src/Functions/keyvaluepair/impl/KeyValuePairExtractorBuilder.h b/src/Functions/keyvaluepair/impl/KeyValuePairExtractorBuilder.h
index 0c673f12..b3f792cb 100644
--- a/src/Functions/keyvaluepair/impl/KeyValuePairExtractorBuilder.h
+++ b/src/Functions/keyvaluepair/impl/KeyValuePairExtractorBuilder.h
@@ -2,6 +2,7 @@
 
 #include <memory>
 #include <vector>
+#include <limits>
 
 namespace DB
 {
diff --git a/src/IO/HTTPHeaderEntries.h b/src/IO/HTTPHeaderEntries.h
index 36b2ccc4..3bcffeba 100644
--- a/src/IO/HTTPHeaderEntries.h
+++ b/src/IO/HTTPHeaderEntries.h
@@ -1,5 +1,6 @@
 #pragma once
 #include <string>
+#include <vector>
 
 namespace DB
 {
diff --git a/src/Interpreters/InterpreterInsertQuery.h b/src/Interpreters/InterpreterInsertQuery.h
index 894c7c42..77a43d21 100644
--- a/src/Interpreters/InterpreterInsertQuery.h
+++ b/src/Interpreters/InterpreterInsertQuery.h
@@ -5,6 +5,7 @@
 #include <Parsers/ASTInsertQuery.h>
 #include <Storages/StorageInMemoryMetadata.h>
 #include <Common/ThreadStatus.h>
+#include <IO/ReadBuffer.h>
 
 namespace DB
 {
diff --git a/src/Server/waitServersToFinish.h b/src/Server/waitServersToFinish.h
index 2eb3092f..4d6d8960 100644
--- a/src/Server/waitServersToFinish.h
+++ b/src/Server/waitServersToFinish.h
@@ -3,6 +3,7 @@
 #include <mutex>
 
 #include <Core/Types.h>
+#include <mutex>
 
 namespace DB
 {
diff --git a/src/Storages/MergeTree/IPartMetadataManager.h b/src/Storages/MergeTree/IPartMetadataManager.h
index e817421f..5a1c2701 100644
--- a/src/Storages/MergeTree/IPartMetadataManager.h
+++ b/src/Storages/MergeTree/IPartMetadataManager.h
@@ -4,6 +4,7 @@
 #include <unordered_map>
 #include <city.h>
 #include <base/types.h>
+#include <memory>
 
 namespace DB
 {
diff --git a/src/Storages/NATS/NATSConnection.cpp b/src/Storages/NATS/NATSConnection.cpp
index 4d30d6b2..0312aa7e 100644
--- a/src/Storages/NATS/NATSConnection.cpp
+++ b/src/Storages/NATS/NATSConnection.cpp
@@ -1,3 +1,5 @@
+#include <string.h>
+#include <cstring>
 #include "NATSConnection.h"
 
 #include <IO/WriteHelpers.h>
diff --git a/src/Storages/NATS/NATSHandler.h b/src/Storages/NATS/NATSHandler.h
index 6f9ec398..89c1039f 100644
--- a/src/Storages/NATS/NATSHandler.h
+++ b/src/Storages/NATS/NATSHandler.h
@@ -1,5 +1,6 @@
 #pragma once
 
+#include <cstdlib>
 #include <uv.h>
 #include <memory>
 #include <mutex>
diff --git a/src/Storages/StorageLogSettings.h b/src/Storages/StorageLogSettings.h
index e89ed90f..9f817a63 100644
--- a/src/Storages/StorageLogSettings.h
+++ b/src/Storages/StorageLogSettings.h
@@ -2,6 +2,7 @@
 
 #include <memory>
 #include <base/types.h>
+#include <memory>
 
 namespace DB
 {
-- 
2.50.1 (Apple Git-155)

