From e546b6aee1342b738f8033636772e0fefe122c9f Mon Sep 17 00:00:00 2001
From: Oxide Computer Company <eng@oxide.computer>
Date: Fri, 24 Oct 2025 15:29:40 -0400
Subject: [PATCH 08/61] Rename tokens due to regset.h pollution

---
 src/Client/ClientApplicationBase.cpp | 2 +-
 src/Client/ClientBase.cpp            | 4 ++--
 src/Client/ClientBase.h              | 2 +-
 src/Common/StackTrace.h              | 4 ++++
 4 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/src/Client/ClientApplicationBase.cpp b/src/Client/ClientApplicationBase.cpp
index 71d13ad4..c0db8117 100644
--- a/src/Client/ClientApplicationBase.cpp
+++ b/src/Client/ClientApplicationBase.cpp
@@ -310,7 +310,7 @@ void ClientApplicationBase::init(int argc, char ** argv)
             case TTY:
                 getClientConfiguration().setString("progress", "tty");
                 break;
-            case ERR:
+            case XERR:
                 getClientConfiguration().setString("progress", "err");
                 break;
         }
diff --git a/src/Client/ClientBase.cpp b/src/Client/ClientBase.cpp
index 8f69eaf5..65b1f3ca 100644
--- a/src/Client/ClientBase.cpp
+++ b/src/Client/ClientBase.cpp
@@ -135,7 +135,7 @@ ProgressOption toProgressOption(std::string progress)
     if (progress == "TTY" || progress == "ON" || progress == "TRUE" || progress == "1" || progress == "YES")
         return ProgressOption::TTY;
     if (progress == "ERR")
-        return ProgressOption::ERR;
+        return ProgressOption::XERR;
     if (progress == "DEFAULT")
         return ProgressOption::DEFAULT;
 
@@ -825,7 +825,7 @@ void ClientBase::initTTYBuffer(ProgressOption progress)
         }
     }
 
-    if (stderr_is_a_tty || progress == ProgressOption::ERR)
+    if (stderr_is_a_tty || progress == ProgressOption::XERR)
     {
         tty_buf = std::make_unique<WriteBufferFromFileDescriptor>(STDERR_FILENO, buf_size);
     }
diff --git a/src/Client/ClientBase.h b/src/Client/ClientBase.h
index 45251aea..4778a125 100644
--- a/src/Client/ClientBase.h
+++ b/src/Client/ClientBase.h
@@ -62,7 +62,7 @@ enum ProgressOption
     DEFAULT,
     OFF,
     TTY,
-    ERR,
+    XERR,
 };
 ProgressOption toProgressOption(std::string progress);
 std::istream& operator>> (std::istream & in, ProgressOption & progress);
diff --git a/src/Common/StackTrace.h b/src/Common/StackTrace.h
index 2078828f..9f750a13 100644
--- a/src/Common/StackTrace.h
+++ b/src/Common/StackTrace.h
@@ -16,6 +16,10 @@
 #   define _XOPEN_SOURCE 700
 #endif
 #include <ucontext.h>
+#ifdef OS_SUNOS
+#undef FS
+#undef SS
+#endif
 
 struct NoCapture
 {
-- 
2.50.1 (Apple Git-155)

